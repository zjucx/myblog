var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=this.getBoundingClientRect();(t.bottom>e||t.top<0)&&this.scrollIntoView()});var MarkdownIME;!function(e){var t;!function(e){function t(e){return e.replace(/(&|  |"|\<|\>)/g,function(e){return o[e]})}function n(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function r(e){return e.replace(/&(nbsp|amp|quot|lt|gt);/g,function(e,t){return a[t]})}function i(e){return e.replace(/[\t\r\n ]+/," ").trim()}var o={"&":"&amp;","  ":"&nbsp;",'"':"&quot;","<":"&lt;",">":"&gt;"};e.text2html=t,e.text2regex=n;var a={nbsp:String.fromCharCode(160),amp:"&",quot:'"',lt:"<",gt:">"};e.html_entity_decode=r,e.trim=i}(t=e.Utils||(e.Utils={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){function t(e,t){return void 0===t&&(t=!0),e?e.nodeType==Node.TEXT_NODE&&/^[\s\r\n]*$/.test(e.nodeValue)||e.nodeType==Node.COMMENT_NODE||t&&"BR"==e.nodeName:!1}function n(e){return!t(e)}function r(e){if(!e)return!1;if(1!=e.nodeType)return!1;var t=h.NodeName;return t.line.test(e.nodeName)||t.li.test(e.nodeName)||t.pre.test(e.nodeName)}function i(e){var t=s(e),n=t.length;if(1==n&&1==t[0].nodeType)return i(t[0]);for(;n--;){var r=t[n];if(r.nodeType!=Node.TEXT_NODE)return!1}return!0}function o(e){return 0!=e.textContent.length?!1:!(e.innerHTML.indexOf("<img ")>=0)}function a(e,t){var n=e.previousSibling;return n&&n.nodeName==t||(n=e.ownerDocument.createElement(t),e.parentNode.insertBefore(n,e)),n}function s(e){return[].filter.call(e.childNodes,n)}function l(e,t){var n,r=[];return n=e.previousSibling,r}function d(e,t){for(var n=[],r=e.parentElement;r&&(n.push(r),r!==t);)r=r.parentElement;return n}function c(e,t){t.parentNode.replaceChild(e,t),e.appendChild(t)}function u(e,t,n){var r="<"+e;if(t)for(var i in t)if(t.hasOwnProperty(i)){var o=""+t[i];o=o.replace(/&/g,"&amp;"),o=o.replace(/"/g,"&quot;"),o=o.replace(/</g,"&lt;"),o=o.replace(/\t/g,"&#x9;"),o=o.replace(/\r/g,"&#xA;"),o=o.replace(/\n/g,"&#xD;"),r+=" "+i+'="'+o+'"'}return r+=">",n?r+=n+"</"+e+">":h.NodeName.autoClose.test(e)||(r+="</"+e+">"),r}var h;!function(e){var t;!function(e){e.list=/^(UL|OL)$/i,e.li=/^LI$/i,e.cell=/^T[HD]$/i,e.line=/^(P|DIV|H\d|T[HD])$/i,e.blockquote=/^BLOCKQUOTE$/i,e.pre=/^PRE$/i,e.hr=/^HR$/i,e.autoClose=/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i}(t=e.NodeName||(e.NodeName={}))}(h=e.Pattern||(e.Pattern={})),e.is_node_empty=t,e.is_node_not_empty=n,e.is_node_block=r,e.is_line_container_clean=i,e.is_line_empty=o,e.get_or_create_prev_block=a,e.get_real_children=s,e.get_line_nodes=l,e.build_parent_list=d,e.wrap=c,e.generateElementHTML=u}(t=e.Utils||(e.Utils={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){function t(t){for(var n=t.ownerDocument,r=n.defaultView.getSelection(),i=n.createRange(),o=t;o.nodeType===Node.ELEMENT_NODE;){for(var a=o.childNodes.length;-1!==--a;){var s=o.childNodes[a];if(s.nodeType===Node.TEXT_NODE||s.nodeType===Node.ELEMENT_NODE){o=s;break}}if(-1===a)break}e.Pattern.NodeName.autoClose.test(o.nodeName)?i.selectNode(o):i.selectNodeContents(o),i.collapse("BR"===o.nodeName),r.removeAllRanges(),r.addRange(i),o.parentElement&&o.parentElement.scrollIntoViewIfNeeded(!0)}e.move_cursor_to_end=t}(t=e.Utils||(e.Utils={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){var t=function(){function e(e,t,n){this.i=0,this.iStack=[],this.renderer=e,this.document=t,this.tokens=n}return e.prototype.toString=function(e){var t=e||this.tokens;return t.map(function(e){return"string"==typeof e.data?e.data:e.data.textContent}).join("")},e.prototype.toFragment=function(e){var t=this,n=e||this.tokens,r=this.document.createDocumentFragment();return n.map(function(e){var n;n="string"==typeof e.data?t.document.createTextNode(e.data):e.data,r.appendChild(n)}),r},e.prototype.pushi=function(){this.iStack.push(this.i)},e.prototype.popi=function(){this.i=this.iStack.pop()},e.prototype.stacki=function(e){return this.iStack[this.iStack.length-e]},e.prototype.isToken=function(e,t){return e&&e.isToken&&e.data===t},e.prototype.splice=function(e,t){function n(n){return n>=e-1+t?n-1-t+o:n>e-1?e-1:n}for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=r.length;this.i=n(this.i),this.iStack=this.iStack.map(n);var a=[].splice.apply(this.tokens,arguments);return a},e.prototype.execute=function(){var e=this;for(this.i=0;this.i<this.tokens.length;){var t=this.tokens[this.i];if(t.isToken){this.renderer.tokenChars[t.data].some(function(t){return t.Proc(e)})}this.i++}this.mergeTextNode(),this.renderer.rules.forEach(function(t){var n=t&&t.afterProc;"function"==typeof n&&n.call(t,e)}),this.mergeTextNode()},e.prototype.mergeTextNode=function(){for(var e=this.tokens,t=e.length;--t>=1;){var n=e[t],r=e[t-1];"string"==typeof n.data&&"string"==typeof r.data&&(r.data+=n.data,e.splice(t,1))}},e.prototype.debugDump=function(e){var t=0,n="I = "+this.i+"\nSTACK = "+this.iStack.join(" -> ")+" \n 0	 "+JSON.stringify(this.tokens).slice(1,-1).replace(/},{/g,function(e){return"}\n "+ ++t+"	 {"});return n},e}();e.InlineRenderProcess=t;var n=function(){function e(){this.rules=[],this.tokenChars={}}return e.prototype.RenderNode=function(e){var n=this.parse(e),r=new t(this,e.ownerDocument,n);r.execute();var i=r.toFragment();if(e.innerHTML)e.innerHTML="";else for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(i)},e.prototype.parse=function(e){function t(){a&&n.push({isToken:!1,data:a}),a=""}for(var n=[],r=e.childNodes,i=r.length,o=-1,a="";++o!==i;){var s=r[o];if(s.nodeType===Node.TEXT_NODE){var l=!1,d=s.textContent;if(d.length){for(var c=0;c!==d.length;c++){var u=d.charAt(c);l||!this.tokenChars.hasOwnProperty(u)?(l?l=!1:"\\"===u&&(l=!0),a+=u):(t(),n.push({isToken:!0,data:u}))}t()}}else n.push({isToken:!1,data:s})}return n},e.prototype.addRule=function(e){if(this.rules.push(e),e.Proc&&e.tokens){var t=this.tokenChars;e.tokens.forEach(function(n){t[n]?t[n].push(e):t[n]=[e]})}},e}();e.InlineRenderer=n}(t=e.Renderer||(e.Renderer={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(t){var n=function(){function t(){this.childNodeName=null,this.parentNodeName=null,this.isTypable=!0,this.removeFeatureMark=!0}return t.prototype.Elevate=function(t){var n=this.prepareElevate(t);if(!n)return null;var r,i;if(this.childNodeName){for(r=t.ownerDocument.createElement(this.childNodeName);t.firstChild;)r.appendChild(t.firstChild);t.parentNode.insertBefore(r,t),t.parentElement.removeChild(t)}else r=t;return this.parentNodeName?r.previousElementSibling&&r.previousElementSibling.nodeName==this.parentNodeName?(i=r.previousElementSibling,i.appendChild(r)):(i=r.ownerDocument.createElement(this.parentNodeName),e.Utils.wrap(i,r)):i=null,{child:r,parent:i,feature:n}},t.prototype.prepareElevate=function(e){if(!e)return null;var t=this.featureMark.exec(e.textContent);if(!t)return null;if(this.removeFeatureMark){var n=e;n.innerHTML=n.innerHTML.replace(/&nbsp;/g,String.fromCharCode(160)).replace(this.featureMark,"")}return t},t}();t.BlockRendererContainer=n;var r;!function(e){var t=function(e){function t(){e.call(this),this.name="unordered list",this.featureMark=/^\s*[\*\+\-]\s+/,this.childNodeName="LI",this.parentNodeName="UL"}return __extends(t,e),t}(n);e.UL=t;var r=function(e){function t(){e.call(this),this.name="ordered list",this.featureMark=/^\s*(\d+)\.\s+/,this.childNodeName="LI",this.parentNodeName="OL"}return __extends(t,e),t.prototype.Elevate=function(t){var n=e.prototype.Elevate.call(this,t);return n&&1===n.parent.childElementCount&&n.parent.setAttribute("start",n.feature[1]),n},t}(n);e.OL=r;var i=function(e){function t(){e.call(this),this.name="blockquote",this.featureMark=/^(\>|&gt;)\s*/,this.parentNodeName="BLOCKQUOTE"}return __extends(t,e),t}(n);e.BLOCKQUOTE=i;var o=function(e){function t(){e.call(this),this.isTypable=!1,this.name="hr",this.featureMark=/^\s{0,2}([\-_\=\*])(\s*\1){2,}$/}return __extends(t,e),t.prototype.Elevate=function(e){if(!this.prepareElevate(e))return null;var t=e.ownerDocument.createElement("hr");return e.parentElement.insertBefore(t,e),e.parentElement.removeChild(e),{parent:null,child:t}},t}(n);e.HR=o;var a=function(e){function t(){e.call(this),this.name="code block",this.featureMark=/^```(\s*(\w+)\s*)?$/,this.removeFeatureMark=!1}return __extends(t,e),t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;var n=e.ownerDocument,r=n.createElement("code"),i=n.createElement("pre");return r.innerHTML='<br data-mdime-bogus="true">',i.appendChild(r),e.parentNode.insertBefore(i,e),e.parentElement.removeChild(e),t[1]&&(i.setAttribute("lang",t[2]),r.setAttribute("class",t[2])),{parent:i,child:r}},t}(n);e.CodeBlock=a;var s=function(e){function t(){e.call(this),this.name="header text",this.featureMark=/^(#+)\s+/}return __extends(t,e),t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;for(var n=e.ownerDocument.createElement("H"+t[1].length);e.firstChild;)n.appendChild(e.firstChild);return e.parentNode.insertBefore(n,e),e.parentElement.removeChild(e),{parent:null,child:n}},t}(n);e.HeaderText=s;var l=function(e){function t(){e.call(this),this.name="table header",this.featureMark=/^\|(.+)\|$/,this.removeFeatureMark=!1}return __extends(t,e),t.prototype.Elevate=function(e){var t=this.prepareElevate(e);if(!t)return null;var n=e.ownerDocument,r=n.createElement("table"),i=n.createElement("tbody"),o=n.createElement("tr"),a=t[1].split("|").map(function(e){var t=n.createElement("th");return t.textContent=e.trim(),o.appendChild(t),t});r.appendChild(i),i.appendChild(o);var s=e.parentElement;s.insertBefore(r,e),s.removeChild(e);var l=n.createElement(e.nodeName);return l.innerHTML='<br data-mdime-bogus="true">',s.insertBefore(l,r.nextElementSibling),{parent:r,child:a[0]}},t}(n);e.TableHeader=l}(r=t.BlockRendererContainers||(t.BlockRendererContainers={}));var i=function(){function e(){this.containers=[]}return e.prototype.Elevate=function(e){for(var t,n=null,r=e;t=this.ElevateOnce(r);)r=t.child,n=t;return n},e.prototype.ElevateOnce=function(e){for(var t=0;t<this.containers.length;t++){var n=this.containers[t],r=n.Elevate(e);if(r)return r.containerType=n,r}return null},e.prototype.GetSuggestedNodeName=function(e){for(var t=0;t<this.containers.length;t++){var n=this.containers[t];if(n.parentNodeName==e.nodeName)return n.childNodeName}return null},e.prototype.AddMarkdownRules=function(){return this.containers=e.markdownContainers.concat(this.containers),this},e.markdownContainers=[new r.CodeBlock,new r.TableHeader,new r.BLOCKQUOTE,new r.HeaderText,new r.HR,new r.OL,new r.UL],e}();t.BlockRenderer=i}(t=e.Renderer||(e.Renderer={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.Proc=function(e){var t=e.stacki(1),n=e.tokens[t]||{isToken:!1,data:""},r=e.i,i=e.tokens[r];if(n.isToken&&this.isLeftBracket(e,n,t)&&i.isToken&&this.isRightBracket(e,i,r)){var o=e.stacki(1),a=e.i;return this.ProcWrappedContent(e,o,a),e.popi(),!0}return i.isToken&&this.isLeftBracket(e,i,r)?(e.pushi(),!0):!1},e}();e.InlineBracketRuleBase=t}(t=e.Renderer||(e.Renderer={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){var t;!function(t){t.InlineRules=["Emphasis","StrikeThrough","LinkAndImage","LinkAndImageData","InlineCode"];var n=function(e){function t(){e.apply(this,arguments),this.name="Markdown Emphasis",this.tokens=["*"],this.tagNameEmphasis="i",this.tagNameStrong="b"}return __extends(t,e),t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])},t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])},t.prototype.ProcWrappedContent=function(e,t,n){if(n===t+1)return e.pushi(),void e.pushi();var r=e.tokens.slice(t+1,n),i=this.tagNameEmphasis,o=e.document;if(e.isToken(e.tokens[t-1],this.tokens[0])&&e.isToken(e.tokens[n+1],this.tokens[0]))i=this.tagNameStrong,t-=1,n+=1,e.popi();else if(r.some(function(e){return!e.isToken&&/^(EM|I)$/.test(e.data.nodeName)})){if(r.length>1)e.pushi(),e.pushi();else{e.splice(t,n-t+1);for(var a=r[0].data,s=o.createElement(this.tagNameStrong);a.firstChild;)s.appendChild(a.firstChild);e.splice(t,0,{isToken:!1,data:s})}return}e.splice(t,n-t+1);var l=e.toFragment(r),d=o.createElement(i);d.appendChild(l),e.splice(t,0,{isToken:!1,data:d})},t}(e.InlineBracketRuleBase);t.Emphasis=n;var r=function(e){function t(){e.apply(this,arguments),this.name="Markdown StrikeThrough",this.tokens=["~"],this.tagName="del"}return __extends(t,e),t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])&&e.isToken(e.tokens[n-1],this.tokens[0])},t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])&&e.isToken(e.tokens[n+1],this.tokens[0])},t.prototype.ProcWrappedContent=function(e,t,n){if(n!==t+1){var r=e.document,i=e.splice(t-1,n-t+3);i=i.slice(2,-2);var o=e.toFragment(i),a=r.createElement(this.tagName);a.appendChild(o),e.splice(t-1,0,{isToken:!1,data:a})}},t}(e.InlineBracketRuleBase);t.StrikeThrough=r;var i=function(e){function t(){e.apply(this,arguments),this.name="Markdown Link and Image",this.tokens=["[","]","!"]}return __extends(t,e),t.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])},t.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[1])},t.prototype.ProcWrappedContent=function(e,t,n){var r,i=e.document,o=e.tokens.slice(t+1,n);if(e.isToken(e.tokens[t-1],this.tokens[2]))r=i.createElement("img"),r.setAttribute("alt",e.toString(o)),t--;else{if(0===o.length)return;var a=e.toFragment(o);r=i.createElement("a"),r.setAttribute("href",""),r.appendChild(a)}e.splice(t,n-t+1,{isToken:!1,data:r})},t}(e.InlineBracketRuleBase);t.LinkAndImage=i;var o=function(){function e(){this.name="Markdown Link and Image Data",this.tokens=["(",")"]}return e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return!1;var r=e.tokens[t-1];if(!r||r.isToken||!r.data.nodeName)return!1;var i,o=r.data;if("IMG"===o.tagName)i="src";else{if("A"!==o.tagName)return!1;i="href"}for(;++e.i<e.tokens.length;){var a=e.tokens[e.i];if(e.isToken(a,this.tokens[1])){var s=e.toString(e.tokens.slice(t+1,e.i)).trim();return o.setAttribute(i,s),e.splice(t,e.i-t+1),!0}}return!1},e}();t.LinkAndImageData=o;var a=function(){function e(){this.name="Markdown Inline Code",this.tokens=["`"]}return e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return!1;for(;++e.i<e.tokens.length;){var r=e.tokens[e.i];if(e.isToken(r,this.tokens[0])){if(e.i===t+1)return!1;var i=e.document.createElement("code");return i.textContent=e.toString(e.tokens.slice(t+1,e.i)).trim(),e.splice(t,e.i-t+1,{isToken:!1,data:i}),!0}}return!1},e}();t.InlineCode=a}(t=e.Markdown||(e.Markdown={}))}(t=e.Renderer||(e.Renderer={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(t){var n=function(t){function n(){var e=this;t.call(this),this.name="Emoji",this.tokens=[":"],this.use_shortcuts=!0,this.use_twemoji=!0,this.twemoji_config={},this.shortcuts_cache=[],this.chars={smile:["ðŸ˜„","smiley"],happy:"ðŸ˜ƒ",grin:["ðŸ˜€","grinning"],blush:"ðŸ˜Š",wink:"ðŸ˜‰",sad:["ðŸ˜”","pensive"],"+1":"ðŸ‘","-1":"ðŸ‘Ž",heart_eyes:"ðŸ˜",kiss:["ðŸ˜™","kissing"],tongue:"ðŸ˜œ",flushed:"ðŸ˜³",relieved:"ðŸ˜Œ",unamused:"ðŸ˜’",disappointed:"ðŸ˜ž",persevere:"ðŸ˜£",cry:"ðŸ˜¢",joy:"ðŸ˜‚",sob:"ðŸ˜­",sleepy:"ðŸ˜ª",cold_sweat:"ðŸ˜°",sweat:"ðŸ˜“",weary:"ðŸ˜©",tired:"ðŸ˜«",fearful:["ðŸ˜¨","fear"],scream:"ðŸ˜±",angry:"ðŸ˜ ",rage:"ðŸ˜¡",confounded:"ðŸ˜–",laugh:["ðŸ˜†","laughing","satisfied"],yum:"ðŸ˜‹",mask:"ðŸ˜·",sunglasses:["ðŸ˜Ž","cool"],sleeping:"ðŸ˜´",dizzy:"ðŸ˜µ",astonished:"ðŸ˜²",worry:["ðŸ˜Ÿ","worried"],frown:["ðŸ˜¦","frowning"],anguished:"ðŸ˜§",imp:"ðŸ‘¿",smiling_imp:"ðŸ˜ˆ",open_mouth:"ðŸ˜®",neutral:"ðŸ˜",confused:"ðŸ˜•",hushed:"ðŸ˜¯",no_mouth:"ðŸ˜¶",innocent:["ðŸ˜‡","angel"],smirk:"ðŸ˜",expressionless:"ðŸ˜‘",joy_cat:"ðŸ˜¹",pouting_cat:"ðŸ˜¾",heart:["â¤ï¸","love"],broken_heart:"ðŸ’”",two_hearts:"ðŸ’•",sparkles:["âœ¨","star"],fist:"âœŠ",hand:"âœ‹",raised_hand:"âœ‹",cat:"ðŸ±",mouse:"ðŸ­",cow:"ðŸ®",monkey:"ðŸµ",star:"â­",zap:"âš¡",umbrella:"â˜”",hourglass:"âŒ›",watch:"âŒš",black_joker:"ðŸƒ",mahjong:"ðŸ€„",coffee:"â˜•",anchor:"âš“",wheelchair:"â™¿",aries:"â™ˆ",taurus:"â™‰",gemini:"â™Š",cancer:"â™‹",leo:"â™Œ",virgo:"â™",libra:"â™Ž",scorpius:"â™",sagittarius:"â™",capricorn:"â™‘",aquarius:"â™’",pisces:"â™“",loop:"âž°"},this.shortcuts={angry:[">:(",">:-("],blush:[':")',':-")'],broken_heart:["</3","<\\3"],confused:[":/",":-/",":\\",":-\\"],cry:[":'(",":'-(",":,(",":,-("],frowning:[":(",":-("],heart:["<3"],two_hearts:[/(<3|â¤){2}/g],imp:["]:(","]:-("],innocent:["o:)","O:)","o:-)","O:-)","0:)","0:-)"],joy:[":')",":'-)",":,)",":,-)",":'D",":'-D",":,D",":,-D"],kissing:[":*",":-*"],laughing:["x-)","X-)"],neutral:[":|",":-|"],open_mouth:[":o",":-o",":O",":-O"],rage:[":@",":-@"],smile:[":D",":-D"],smiley:[":)",":-)"],smiling_imp:["]:)","]:-)"],sob:[":,'(",":,'-(",";(",";-("],tongue:[":P",":-P"],sunglasses:["8-)","B-)"],sweat:[",:(",",:-("],unamused:[":s",":-S",":z",":-Z",":$",":-$"],wink:[";)",";-)"]};for(var n in this.chars){var r=this.chars[n];if(r&&r.length&&r.length>1&&r[1].length>1){var i=r.shift();r.push(n),r.forEach(function(t){return e.chars[t]=i})}}}return __extends(n,t),n.prototype.isLeftBracket=function(e,t,n){return e.isToken(t,this.tokens[0])},n.prototype.isRightBracket=function(e,t,n){return e.isToken(t,this.tokens[0])},n.prototype.ProcWrappedContent=function(e,t,n){var r=e.tokens[t+1].data;if(n!==t+2)return!1;if("string"!=typeof r)return!1;var i=this.chars[r];return"string"!=typeof i?!1:(e.splice(t,3,{isToken:!1,data:i}),!0)},n.prototype.afterProc=function(e){this.shortcuts_cache.length||this.UpdateShortcutCache();for(var t=0;t<e.tokens.length;t++){var n=e.tokens[t];if("string"==typeof n.data){for(var r=n.data,i=this.shortcuts_cache.length-1;i>=0;i--){var o=this.chars[this.shortcuts_cache[i].targetName];r=r.replace(this.shortcuts_cache[i].regexp,o)}n.data=r}}if(this.use_twemoji&&"undefined"!=typeof twemoji)for(var a=document.createElement("div"),t=0;t<e.tokens.length;t++){var n=e.tokens[t];if("string"==typeof n.data){var r=n.data;a.innerHTML=twemoji.parse(r,this.twemoji_config);var s=e.renderer.parse(a);s=[t,1].concat(s),[].splice.apply(e.tokens,s)}}},n.prototype.UpdateShortcutCache=function(){this.shortcuts_cache=[];for(var t in this.shortcuts)for(var n=this.shortcuts[t],r=n.length-1;r>=0;r--){var i=n[r];i instanceof RegExp||(i=new RegExp(e.Utils.text2regex(i),"g")),this.shortcuts_cache.push({regexp:i,length:i.toString().length,targetName:t})}this.shortcuts_cache.sort(function(e,t){return e.length-t.length})},n}(e.Renderer.InlineBracketRuleBase);t.EmojiAddon=n}(t=e.Addon||(e.Addon={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(t){function n(e){var n=t.blockRenderer.Elevate(e);if(n){if(!n.containerType.isTypable)return n.child;e=n.child}return t.inlineRenderer.RenderNode(e),e}t.inlineRenderer=new t.InlineRenderer,t.blockRenderer=new t.BlockRenderer,t.emojiRule=new e.Addon.EmojiAddon,t.Markdown.InlineRules.forEach(function(e){var n=t.Markdown[e];t.inlineRenderer.addRule(new n)}),t.inlineRenderer.addRule(t.emojiRule),t.blockRenderer.AddMarkdownRules(),t.Render=n}(t=e.Renderer||(e.Renderer={}))}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t=function(){function t(e,n){this.editor=e,this.document=e.ownerDocument,this.window=e.ownerDocument.defaultView,this.selection=this.window.getSelection(),this.isTinyMCE=/tinymce/i.test(e.id),this.isIE=/MSIE|Trident\//.test(this.window.navigator.userAgent),this.config=n||{};for(var r in t.defaultConfig)this.config.hasOwnProperty(r)||(this.config[r]=t.defaultConfig[r])}return t.prototype.Init=function(){return this.editor.hasAttribute("contenteditable")?this.editor.hasAttribute("mdime-enhanced")?!1:(this.editor.addEventListener("keydown",this.keydownHandler.bind(this),!1),this.editor.addEventListener("keyup",this.keyupHandler.bind(this),!1),this.editor.addEventListener("input",this.inputHandler.bind(this),!1),this.editor.setAttribute("mdime-enhanced","true"),!0):!1},t.prototype.GetCurrentLine=function(t){var n={line:null,parent_tree:[],half_break:!1},r=t.startContainer;if(this.isTinyMCE){for(var i=r;!e.Utils.is_node_block(i);)i=i.parentElement;if(1!=r.childNodes.length||"BR"!=r.firstChild.nodeName)r=i,n.half_break=!0;else if(e.Utils.Pattern.NodeName.pre.test(i.nodeName))r=i;else if(e.Utils.Pattern.NodeName.cell.test(i.parentElement.nodeName)){r=i.parentElement;for(var o=i.previousSibling,a=void 0;a=o.firstChild;)r.insertBefore(a,o);r.removeChild(o),r.removeChild(i)}else if(r=i.previousSibling,i.parentElement.removeChild(i),e.Utils.Pattern.NodeName.list.test(r.nodeName)){var s=this.document.createElement("li");r.appendChild(s),r=s}}else r.nodeType===Node.TEXT_NODE&&(n.half_break=t.startOffset!==r.textContent.length);for(;!e.Utils.is_node_block(r)&&r!==this.editor;)r=r.parentNode;if(r===this.editor){r=this.document.createElement(this.config.wrapper);var l=this.document.createRange();l.selectNodeContents(this.editor),l.surroundContents(r)}var d=e.Utils.build_parent_list(r,this.editor);return n.line=r,n.parent_tree=d,n},t.prototype.ProcessCurrentLine=function(t){var n=this.selection.getRangeAt(0);if(n.collapsed){var r=this.GetCurrentLine(n),i=r.line,o=r.parent_tree;if(e.Utils.Pattern.NodeName.pre.test(i.nodeName)){var a=this.document.createElement("br");if(!this.isTinyMCE){n.deleteContents(),n.insertNode(a);var s=a.nextSibling;s&&s.nodeType===Node.TEXT_NODE&&0===s.textContent.length&&a.parentNode.removeChild(s),a.nextSibling||a.parentNode.appendChild(this.document.createElement("br")),n.selectNodeContents(a.nextSibling),n.collapse(!0),this.selection.removeAllRanges(),this.selection.addRange(n),t.preventDefault()}var l=i.innerText;if(/^\n*(`{2,3})?\n*$/.test(l.substr(l.length-4))){for(var d=i.firstChild,c=void 0;c=d.lastChild,1===c.nodeType&&"BR"===c.nodeName||3===c.nodeType&&/^\n*(```)?\n*$/.test(c.textContent);)d.removeChild(c);this.CreateNewLine(i)}}else if(e.Utils.is_line_empty(i)){var u=this.GenerateEmptyLine();if(e.Utils.Pattern.NodeName.list.test(i.parentNode.nodeName))i.parentNode.removeChild(i),i=o.shift(),e.Utils.Pattern.NodeName.list.test(i.parentNode.nodeName)&&(u=this.GenerateEmptyLine("li"));else if(e.Utils.Pattern.NodeName.cell.test(i.nodeName)){var h=i.parentElement,p=h.parentElement.parentElement;""===h.textContent.trim()?(h.parentNode.removeChild(h),i=p):(u=this.CreateNewCell(i),i=null)}else e.Utils.Pattern.NodeName.blockquote.test(i.parentNode.nodeName)&&(i.parentNode.removeChild(i),i=o.shift());i&&i.parentNode.insertBefore(u,i.nextSibling),e.Utils.move_cursor_to_end(u),t.preventDefault()}else{if(r.half_break)return;i.lastChild.attributes&&(i.lastChild.attributes.getNamedItem("data-mdime-bogus")||i.lastChild.attributes.getNamedItem("data-mce-bogus"))&&i.removeChild(i.lastChild),i=e.Renderer.Render(i),"PRE"===i.parentNode.nodeName?(e.Utils.move_cursor_to_end(i),t.preventDefault()):this.CreateNewLine(i)?t.preventDefault():e.Utils.move_cursor_to_end(i)}}},t.prototype.CreateNewCell=function(t){if(!t||!e.Utils.Pattern.NodeName.cell.test(t.nodeName))return null;for(var n,r=t.parentNode,i=(r.parentNode.parentNode,this.document.createElement("tr")),o=r.childNodes.length;o--;)if(e.Utils.Pattern.NodeName.cell.test(r.childNodes[o].nodeName)){var a=i.insertCell(0);a.innerHTML=this.config.emptyBreak,r.childNodes[o]===t&&(n=a)}return r.parentNode.insertBefore(i,r.nextSibling),n},t.prototype.CreateNewLine=function(t){var n,r=e.Utils.Pattern.NodeName;if(r.cell.test(t.nodeName))return n=this.CreateNewCell(t),e.Utils.move_cursor_to_end(n),n;var i=null;return r.li.test(t.nodeName)&&(i="li"),n=this.GenerateEmptyLine(i),t.parentNode.insertBefore(n,t.nextSibling),e.Utils.move_cursor_to_end(n),n},t.prototype.keydownHandler=function(e){var t=this.selection.getRangeAt(0);if(t.collapsed){var n=e.keyCode||e.which,r=!(e.shiftKey||e.ctrlKey||e.altKey);return r&&13===n?void this.ProcessCurrentLine(e):void this.keydownHandler_Table(e)}},t.prototype.instantRender=function(t,n){for(var r=t.startContainer.parentNode,i=r;!e.Utils.is_node_block(i);)i=i.parentNode;if(i===this.editor)return!1;if("PRE"===i.nodeName)return!1;if("CODE"===r.nodeName)return!1;if(r===i&&t.startContainer.nodeType===Node.TEXT_NODE&&t.startContainer===i.firstChild){var o=e.Renderer.blockRenderer.Elevate(i);if(o){var a=o.child;return 0===a.textContent.length&&(a.innerHTML=this.config.emptyBreak),void(n&&e.Utils.move_cursor_to_end(a))}}t.setStart(r,0);var s=t.extractContents();e.Renderer.inlineRenderer.RenderNode(s);var l=r.firstChild;l.nodeType===Node.TEXT_NODE&&""===l.textContent&&(r.removeChild(l),l=r.firstChild);var d=s.lastChild;if(r.insertBefore(s,l),n)if(d.nodeType===Node.TEXT_NODE)e.Utils.move_cursor_to_end(d);else{var c=this.document.createRange();c.selectNode(d),c.collapse(!1),this.selection.removeAllRanges(),this.selection.addRange(c)}},t.prototype.keyupHandler=function(e){var t=e.keyCode||e.which,n=this.selection.getRangeAt(0);this.isIE&&32===t&&n.collapsed&&n.startContainer.nodeType===Node.TEXT_NODE&&this.instantRender(n,!0)},t.prototype.inputHandler=function(e){var t=this.selection.getRangeAt(0);t.collapsed&&t.startContainer.nodeType===Node.TEXT_NODE&&/\s$/.test(t.startContainer.textContent)&&this.instantRender(t,!0)},t.prototype.GenerateEmptyLine=function(e){void 0===e&&(e=null);var t;return t=this.document.createElement(e||this.config.wrapper||"div"),t.innerHTML=this.config.emptyBreak,t},t.prototype.keydownHandler_Table=function(t){var n=t.keyCode||t.which,r=!(t.shiftKey||t.ctrlKey||t.altKey);if(8!==n&&45!==n&&46!==n&&9!==n&&(37>n||n>40))return!1;var i=this.selection.getRangeAt(0),o=e.Utils.build_parent_list(i.startContainer,this.editor);o.unshift(i.startContainer);var a=o.filter(e.Utils.is_node_block),s=a[0],l=s.parentElement,d=l.parentElement.parentElement;if(!e.Utils.Pattern.NodeName.cell.test(s.nodeName))return!1;for(var c=0,u=l.childElementCount;u>c&&l.children[c]!==s;)c++;if(c>=u)return!1;var h=null;switch(n){case 46:case 8:if(r&&"TH"===s.nodeName&&!s.textContent.trim())if(h=46===n&&s.nextElementSibling||s.previousElementSibling)for(var p=0,f=d.childElementCount;f>p;p++)for(var m=d.children[p],v=0,k=m.childElementCount;k>v;v++){var g=m.children[v];g.removeChild(g.children[c])}else h=d.nextElementSibling||this.CreateNewLine(d),d.parentElement.removeChild(d);else r&&!l.textContent.trim()&&(h=l.nextElementSibling||d.nextElementSibling||this.CreateNewLine(d),h.firstElementChild&&(h=h.firstElementChild),l.parentElement.removeChild(l));break;case 45:t.shiftKey||c++;for(var p=0,f=d.childElementCount;f>p;p++)for(var m=d.children[p],E=0,N=m.childElementCount;N>E;E++){var y=m.children[E],C=y.children[c],w=this.document.createElement(y.children[0].tagName);y.insertBefore(w,C)}h=s.parentElement.children[c];break;case 9:r?h=s.nextElementSibling||l.nextElementSibling&&l.nextElementSibling.firstElementChild||this.CreateNewCell(l.firstElementChild):t.shiftKey&&(h=s.previousElementSibling||l.previousElementSibling&&l.previousElementSibling.lastElementChild||d.previousElementSibling);break;case 38:r&&(h=l.previousElementSibling&&l.previousElementSibling.children[c]||d.previousElementSibling);break;case 40:r&&(h=l.nextElementSibling&&l.nextElementSibling.children[c]||d.nextElementSibling)}return h?(e.Utils.move_cursor_to_end(h),t.preventDefault(),!0):!1},t.defaultConfig={wrapper:"p",emptyBreak:/MSIE (9|10)\./.test(navigator.appVersion)?"":'<br data-mdime-bogus="true">'},t}();e.Editor=t}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){!function(e){e[e.Hidden=0]="Hidden",e[e.Shown=1]="Shown",e[e.Hiding=2]="Hiding"}(e.ToastStatus||(e.ToastStatus={}));var t=e.ToastStatus,n=function(){function e(n,r){this.status=t.Hidden,this.document=n;var i=n.createElement("div");i.setAttribute("style",e.style),i.textContent=r,i.addEventListener("mousedown",this.dismiss.bind(this),!1),this.element=i}return e.prototype.setPosition=function(e,t,n){var r=this.element;r.style.left=e+"px",r.style.top=n&&"initial"||t+"px",r.style.bottom=n&&t+"px"||"initial"},e.prototype.show=function(e){var n=this,r=this.element,i=this.dismiss.bind(this);r.parentElement||this.document.body.appendChild(r),setTimeout(function(){n.status=t.Shown,r.style.opacity="1",r.style.marginTop="0",e&&setTimeout(i,e)},10)},e.prototype.dismiss=function(){var e=this;if(this.status===t.Shown){this.status=t.Hiding;var n=this.element;n.style.opacity="0",n.style.marginTop="-10px",setTimeout(function(){n.parentNode.removeChild(n),e.status=t.Hidden},300)}},e.showToast=function(t,n,r,i){var o=n.ownerDocument,a=n.getBoundingClientRect&&n.getBoundingClientRect()||{left:0,top:0},s=new e(o,t);return a.left+=o.body.scrollLeft,a.top+=o.body.scrollTop,s.setPosition(a.left,a.top,!i),s.show(r),s},e.SHORT=1500,e.LONG=3500,e.style="\nposition: absolute;\nfont-family: sans-serif;\npadding: 5px 10px;\nbackground: #e4F68F;\nfont-size: 10pt;\nline-height: 1.4em;\ncolor: #000;\nz-index: 32760;\nmargin-top: -10px;\ntransition: .2s ease;\nopacity: 0;\n",e}();e.Toast=n}(t=e.UI||(e.UI={}))}(MarkdownIME||(MarkdownIME={}));/*!@preserve
    [MarkdownIME](https://github.com/laobubu/MarkdownIME)

    Copyright 2016 laobubu

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
*/
var MarkdownIME;!function(e){function t(e){var n=e.document,r=[].slice.call(n.querySelectorAll("[contenteditable], [designMode]"));return[].forEach.call(n.querySelectorAll("iframe"),function(e){try{var n=t(e.contentWindow);[].push.apply(r,n)}catch(i){}}),r}function n(t){if("number"==typeof t.length&&t[0])return[].map.call(t,n);var r;return r=new e.Editor(t),r.Init()?r:null}function r(r){n(t(r)).forEach(function(t){t&&e.UI.Toast.showToast("MarkdownIME Activated",t.editor,e.UI.Toast.SHORT,!0)})}e.Scan=t,e.Enhance=n,e.Bookmarklet=r}(MarkdownIME||(MarkdownIME={}));var MarkdownIME;!function(e){var t;!function(e){var t=function(){function e(){this.name="MathFormula",this.imgServer="http://latex.codecogs.com/gif.latex?",this.tokens=["$"]}return e.prototype.Proc=function(e){var t=e.i,n=e.tokens[t];if(!e.isToken(n,this.tokens[0]))return!1;for(;++e.i<e.tokens.length;){var r=e.tokens[e.i];if(e.isToken(r,this.tokens[0])){if(e.i===t+1)return!1;var i=e.document.createElement("img"),o=e.toString(e.tokens.slice(t+1,e.i)).trim(),a=this.imgServer+encodeURIComponent(o);return i.setAttribute("src",a),i.setAttribute("alt",o),e.tokens.splice(t,e.i-t+1,{isToken:!1,data:i}),!0}}return!1},e}();e.MathAddon=t}(t=e.Addon||(e.Addon={}))}(MarkdownIME||(MarkdownIME={}));
